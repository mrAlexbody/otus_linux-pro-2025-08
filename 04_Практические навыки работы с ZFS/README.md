–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 04
=
###"–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å ZFS"

###–¶–µ–ª—å:
+ –Ω–∞—É—á–∏—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å ZFS, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—É–ª—ã, –∏–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ZFS;


###–û–ø–∏—Å–∞–Ω–∏–µ/–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:

##üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–∂–∞—Ç–∏–µ–º:
+ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç zfs (gzip, zle, lzjb, lz4);
+ —Å–æ–∑–¥–∞—Ç—å 4 —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º—ã, –Ω–∞ –∫–∞–∂–¥–æ–π –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è;
+ –¥–ª—è —Å–∂–∞—Ç–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–±–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª, –ª–∏–±–æ –≥—Ä—É–ø–ø—É —Ñ–∞–π–ª–æ–≤.

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞.
+ –° –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã zfs import —Å–æ–±—Ä–∞—Ç—å pool ZFS.

–ö–æ–º–∞–Ω–¥–∞–º–∏ zfs –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
+ —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞;
+ —Ç–∏–ø pool;
+ –∑–Ω–∞—á–µ–Ω–∏–µ recordsize;
+ –∫–∞–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è;
+ –∫–∞–∫–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

–†–∞–±–æ—Ç–∞ —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏:
+ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏;
+ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ. zfs receive;
+ –Ω–∞–π—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ secret_message.

---
##–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–∂–∞—Ç–∏–µ–º
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–∏—Å–∫–æ–≤
```shell
root@zfs:~# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
fd0      2:0    1    4K  0 disk
sda      8:0    0   20G  0 disk
‚îú‚îÄsda1   8:1    0    1M  0 part
‚îî‚îÄsda2   8:2    0   20G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    1G  0 disk
sdd      8:48   0    1G  0 disk
sde      8:64   0    1G  0 disk
sdf      8:80   0    1G  0 disk
sdg      8:96   0    1G  0 disk
sdh      8:112  0    1G  0 disk
sdi      8:128  0    1G  0 disk
sr0     11:0    1 1024M  0 rom

```
–£—Å—Ç–∞–Ω–æ–≤–∏–ª –ø–∞–∫–µ—Ç—ã –¥–ª—è ZFS
```shell
root@zfs:~# sudo apt-get install zfsutils-linux
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libnvpair3linux libuutil3linux libzfs4linux libzpool5linux zfs-zed
Suggested packages:
  nfs-kernel-server samba-common-bin zfs-initramfs | zfs-dracut
The following NEW packages will be installed:
  libnvpair3linux libuutil3linux libzfs4linux libzpool5linux zfs-zed zfsutils-linux
0 upgraded, 6 newly installed, 0 to remove and 133 not upgraded.
Need to get 2355 kB of archives.
After this operation, 7399 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 libnvpair3linux amd64 2.2.2-0ubuntu9.4 [62.1 kB]
Get:2 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 libuutil3linux amd64 2.2.2-0ubuntu9.4 [53.2 kB]
Get:3 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 libzfs4linux amd64 2.2.2-0ubuntu9.4 [224 kB]
Get:4 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 libzpool5linux amd64 2.2.2-0ubuntu9.4 [1397 kB]
Get:5 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 zfsutils-linux amd64 2.2.2-0ubuntu9.4 [551 kB]
Get:6 http://ru.archive.ubuntu.com/ubuntu noble-updates/main amd64 zfs-zed amd64 2.2.2-0ubuntu9.4 [67.9 kB]
Fetched 2355 kB in 0s (6372 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libnvpair3linux.
(Reading database ... 73032 files and directories currently installed.)
Preparing to unpack .../0-libnvpair3linux_2.2.2-0ubuntu9.4_amd64.deb ...
Unpacking libnvpair3linux (2.2.2-0ubuntu9.4) ...
Selecting previously unselected package libuutil3linux.
Preparing to unpack .../1-libuutil3linux_2.2.2-0ubuntu9.4_amd64.deb ...
Unpacking libuutil3linux (2.2.2-0ubuntu9.4) ...
Selecting previously unselected package libzfs4linux.
Preparing to unpack .../2-libzfs4linux_2.2.2-0ubuntu9.4_amd64.deb ...
Unpacking libzfs4linux (2.2.2-0ubuntu9.4) ...
Selecting previously unselected package libzpool5linux.
Preparing to unpack .../3-libzpool5linux_2.2.2-0ubuntu9.4_amd64.deb ...
....
Processing triggers for libc-bin (2.39-0ubuntu8.5) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.

```
–°–æ–∑–¥–∞–ª 4-–ø—É–ª–∞ –∏–∑ –¥–≤—É—Ö –¥–∏—Å–∫–æ–≤ –≤ —Ä–µ–∂–∏–º–µ RAID1 
```shell
root@zfs:~# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
fd0      2:0    1    4K  0 disk
sda      8:0    0   20G  0 disk
‚îú‚îÄsda1   8:1    0    1M  0 part
‚îî‚îÄsda2   8:2    0   20G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    1G  0 disk
sdd      8:48   0    1G  0 disk
sde      8:64   0    1G  0 disk
sdf      8:80   0    1G  0 disk
sdg      8:96   0    1G  0 disk
sdh      8:112  0    1G  0 disk
sdi      8:128  0    1G  0 disk
sr0     11:0    1 1024M  0 rom
root@zfs:~# zpool create pool_zfs1 /dev/sdb /dev/sdc
root@zfs:~# zpool create pool_zfs2 /dev/sdd /dev/sde
root@zfs:~# zpool create pool_zfs3 /dev/sdf /dev/sdg
root@zfs:~# zpool create pool_zfs4 /dev/sdh /dev/sdi

```
–ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å
```shell
root@zfs:~# zpool status
  pool: pool_zfs1
 state: ONLINE
config:

        NAME        STATE     READ WRITE CKSUM
        pool_zfs1   ONLINE       0     0     0
          sdb       ONLINE       0     0     0
          sdc       ONLINE       0     0     0

errors: No known data errors

  pool: pool_zfs2
 state: ONLINE
config:

        NAME        STATE     READ WRITE CKSUM
        pool_zfs2   ONLINE       0     0     0
          sdd       ONLINE       0     0     0
          sde       ONLINE       0     0     0

errors: No known data errors

  pool: pool_zfs3
 state: ONLINE
config:

        NAME        STATE     READ WRITE CKSUM
        pool_zfs3   ONLINE       0     0     0
          sdf       ONLINE       0     0     0
          sdg       ONLINE       0     0     0

errors: No known data errors

  pool: pool_zfs4
 state: ONLINE
config:

        NAME        STATE     READ WRITE CKSUM
        pool_zfs4   ONLINE       0     0     0
          sdh       ONLINE       0     0     0
          sdi       ONLINE       0     0     0

errors: No known data errors
root@zfs:~# zpool list
NAME        SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
pool_zfs1  1.88G   120K  1.87G        -         -     0%     0%  1.00x    ONLINE  -
pool_zfs2  1.88G   118K  1.87G        -         -     0%     0%  1.00x    ONLINE  -
pool_zfs3  1.88G   118K  1.87G        -         -     0%     0%  1.00x    ONLINE  -
pool_zfs4  1.88G   118K  1.87G        -         -     0%     0%  1.00x    ONLINE  -

```
–î–æ–±–∞–≤–∏–ª –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è –≤ –∫–∞–∂–¥—É—é —Ñ—Å:
```shell
root@zfs:~# zfs set compression=lzjb pool_zfs1
root@zfs:~# zfs set compression=lz4 pool_zfs2
root@zfs:~# zfs set compression=gzip-9 pool_zfs3
root@zfs:~# zfs set compression=zle pool_zfs4
```
–ü–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:
```shell
root@zfs:~# zfs get compression
NAME       PROPERTY     VALUE           SOURCE
pool_zfs1  compression  lzjb            local
pool_zfs2  compression  lz4             local
pool_zfs3  compression  gzip-9          local
pool_zfs4  compression  zle             local

```
–î–æ–±–∞–≤–∏–ª –≤–æ –≤—Å–µ –ø—É–ª—ã —Ñ–∞–π–ª:
```shell
root@zfs:~# for i in {1..4}; do dd if=/dev/zero of=/pool_zfs$i/my_test_file.txt bs=100M count=100; done
100+0 records in
100+0 records out
10485760000 bytes (10 GB, 9.8 GiB) copied, 7.39607 s, 1.4 GB/s
100+0 records in
100+0 records out
10485760000 bytes (10 GB, 9.8 GiB) copied, 7.02762 s, 1.5 GB/s
100+0 records in
100+0 records out
10485760000 bytes (10 GB, 9.8 GiB) copied, 11.8606 s, 884 MB/s
100+0 records in
100+0 records out
10485760000 bytes (10 GB, 9.8 GiB) copied, 7.25273 s, 1.4 GB/s
```
–ü—Ä–æ–≤–µ—Ä–∏–ª —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:
```shell
root@zfs:~# ls -l /pool_zfs*
'/pool_zfs$':
total 0

/pool_zfs1:
total 1
-rw-r--r-- 1 root root 10485760000 Oct 23 21:06 my_test_file.txt

/pool_zfs2:
total 1
-rw-r--r-- 1 root root 10485760000 Oct 23 21:06 my_test_file.txt

/pool_zfs3:
total 1
-rw-r--r-- 1 root root 10485760000 Oct 23 21:06 my_test_file.txt

/pool_zfs4:
total 1
-rw-r--r-- 1 root root 10485760000 Oct 23 21:07 my_test_file.txt

root@zfs:~# zfs list
NAME        USED  AVAIL  REFER  MOUNTPOINT
pool_zfs1   279K  1.75G    24K  /pool_zfs1
pool_zfs2   278K  1.75G    25K  /pool_zfs2
pool_zfs3   270K  1.75G    25K  /pool_zfs3 <<<
pool_zfs4   282K  1.75G    25K  /pool_zfs4

root@zfs:~# zfs get all | grep compression
pool_zfs1  compression           lzjb                   local
pool_zfs2  compression           lz4                    local
pool_zfs3  compression           gzip-9                 local
pool_zfs4  compression           zle                    local
```
> –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª–∫–∏, –Ω–æ –≤–∏–¥–Ω–æ, —á—Å—Ç–æ —Å–∂–∞—Ç–∏–µ gzip-9 —Å–∞–º–æ–µ —ç—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ !!!

 
